<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ product.title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<header class="site-header">
    <div class="brand">Colorful<span>Shop</span></div>
    <nav>
        {% if session.get('user_id') %}
            <span class="welcome">Hi, {{ session.user_name }}</span>
            <a href="{{ url_for('logout') }}" class="btn">Logout</a>
        {% else %}
            <a href="{{ url_for('login') }}" class="btn">Login</a>
            <a href="{{ url_for('register') }}" class="btn alt">Sign up</a>
        {% endif %}
        <a href="{{ url_for('home') }}" class="btn">Home</a>
    </nav>
</header>

<main class="container product-detail">
    <h1>{{ product.title }}</h1>

    <div class="product-gallery">
        {% for img in images %}
            <img src="{{ url_for('static', filename='images/' + img) }}" alt="{{ product.title }}">
        {% endfor %}
    </div>

    <div class="product-info">
        <p class="price">
            ${{ "%.2f"|format(price_after) }}
            {% if discount > 0 %}
                <span class="original-price">${{ "%.2f"|format(price) }}</span>
                <span class="discount">({{ discount }}% off)</span>
            {% endif %}
        </p>
        <p class="long-desc">{{ product.long_desc | nl2br }}</p>
    </div>

    <section class="reviews" id="reviews">
        <h2>Reviews</h2>

        {% if reviews|length == 0 %}
            <p>No reviews yet.</p>
        {% else %}
            {% for r in reviews %}
                <div class="review">
                    <strong>{{ r.name }}</strong>
                    <span class="rating">{{ '★' * r.rating }}{{ '☆' * (5 - r.rating) }}</span>
                    <p>{{ r.comment | nl2br }}</p>
                </div>
            {% endfor %}
        {% endif %}

        {% if session.get('user_id') %}
            <form method="post" class="review-form">
                {% if review_err %}
                    <p class="errors">{{ review_err }}</p>
                {% endif %}
                <label>Rating:
                    <select name="rating" required>
                        <option value="">Select rating</option>
                        {% for i in range(1,6) %}
                            <option value="{{ i }}">{{ i }} star{{ 's' if i>1 else '' }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label>Comment:
                    <textarea name="comment" rows="4" required></textarea>
                </label>
                <button type="submit" class="btn">Submit Review</button>
            </form>
        {% else %}
            <p><a href="{{ url_for('login') }}">Login</a> to leave a review.</p>
        {% endif %}
    </section>
</main>

<footer class="site-footer">
    <p>© 2025 Colorful Shop. All rights reserved.</p>
</footer>
</body>
</html>
